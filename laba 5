"""Задана рекуррентная функция. Область определения функции – натуральные числа. 
Написать программу сравнительного вычисления данной функции рекурсивно и итерационно (значение, время). 
Определить (смоделировать) границы применимости рекурсивного и итерационного подхода.
Результаты сравнительного исследования времени вычисления представить в табличной и графической форме."""

import timeit
import matplotlib.pyplot as plt
import math

last_factorial = 1
def factorial(n):
    global last_factorial
    last_factorial = n * last_factorial
    return last_factorial

def recursive_factorial(n):
    if n == 1 or n==0:
        return 1
    else:
        return n * recursive_factorial(n-1)

def iterative_factorial(n):
    result = 1
    for i in range(1, n+1):
        result *= i
    return result

k=-1
last_F_value = 1;
step = 1
def recursive_F(n):
    global last_F_value
    if n == 0 or n == 1:
        return 3
    elif n > 23:
        k = (-1)**n
        return k * (3 - recursive_F(n - 1) / recursive_factorial(2 * n) - (n - 2))
    elif n <= 23 and n > 1:
        return (n - 2) * recursive_F(n - 1)

c=-1
last_factorial = 1
def iterative_F(n):
    global c, last_factorial
    F = [0] * (n + 1) 
    F[0] = 3
    F[1] = 3
    for i in range(2, n + 1):
        if i > 23:
            c = (-1)**i 
            F[i] = c * (3 - F[i - 1] / iterative_factorial(2 * i) - (i - 2)) 
        else:
            if i > 1 and i <= 23:
                F[i] = (i - 2) * F[i - 1]

def score_time(func, n):
    return timeit.timeit(lambda: func(n), number=1000)


n_values = range(1, 26)
recursive_times = []
iterative_times = []

for n in n_values:
    recursive_times.append(score_time(recursive_factorial, n))
    iterative_times.append(score_time(iterative_factorial, n))

print(f"{'n':<10}{'Рекурсивное время (мс)':<25}{'Итерационное время (мс)':<25}")
for i, n in enumerate(n_values):
    print(f"{n:<10}{recursive_times[i]:<25}{iterative_times[i]:<25}")

plt.plot(n_values, recursive_times, label='Рекурсивно')
plt.plot(n_values, iterative_times, label='Итерационно')
plt.xlabel('n')
plt.ylabel('Время (в миллисекундах)')
plt.legend()
plt.title('Сравнение времени вычисления функции F(n)')
plt.show()
